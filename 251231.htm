<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>{{TITLE}}8</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- 正しい Leaflet-GPX -->
<script src="https://cdn.jsdelivr.net/gh/mpetazzoni/leaflet-gpx/leaflet-gpx.min.js"></script>
  
<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0;
  line-height: 1.7;
}
header {
  background: #000;
  color: #fff;
  padding: 20px;
  text-align: center;
}
#map {
  width: 100%;
  height: 350px;
}
.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px;
  padding: 10px;
}
.gallery img {
  width: 100%;
  border-radius: 6px;
}
.section {
  padding: 20px;
}
h2 {
  border-left: 5px solid #0078ff;
  padding-left: 10px;
}
</style>
</head>

<body>

<header>
  <h1>{{TITLE}}</h1>
  <p>{{DATE}} / 距離：{{DISTANCE}}km / 獲得標高：{{ELEVATION}}m</p>
</header>

<div id="map"></div>

<div class="section">
  <h2>ルート概要</h2>
  <p>{{DESCRIPTION}}</p>
</div>

<div class="section">
  <h2>写真ギャラリー</h2>
  <div class="gallery">
    {{GALLERY}}
  </div>
</div>

<div class="section">
  <h2>補給ポイント</h2>
  <ul>
    {{FOOD}}
  </ul>
</div>

<div class="section">
  <h2>おすすめ装備</h2>
  <ul>
    <li><a href="{{AFFILIATE1}}">ライト（Amazon）</a></li>
    <li><a href="{{AFFILIATE2}}">補給食（Amazon）</a></li>
    <li><a href="{{AFFILIATE3}}">タイヤ（Amazon）</a></li>
  </ul>
</div>

<script>
// ① map を1回だけ作る
var map = L.map("map").setView([34.6, 135.5], 12);

// ② タイルレイヤー（地図画像）を追加 ← これが抜けていた！
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19,
  attribution: "© OpenStreetMap contributors"
}).addTo(map);

// ③ GPX を map に追加する
new L.GPX("251231_2.gpx", {
  async: true,
  polyline_options: {
    color: "red",
    weight: 4,
    opacity: 0.8
  }
}).on("loaded", function(e) {
  map.fitBounds(e.target.getBounds());
}).addTo(map);
</script>


</body>
</html>
